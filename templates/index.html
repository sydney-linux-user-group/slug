{% extends "base.html" %}
{% comment %}
-*- coding: utf-8 -*-
vim: set ts=2 sw=2 et sts=2 ai:
{% endcomment %}
{% block head %}
    <link rel="StyleSheet" href="/third_party/jquery.tweet/jquery.tweet.css" type="text/css" />
    <link rel="StyleSheet" href="/css/index.css" type="text/css" media="screen">
    <link rel="StyleSheet" href="/css/jquery.tweet.css" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.0/jquery.min.js" type="text/javascript"></script>
    <script src="/third_party/jquery.tweet/jquery.tweet.js" type="text/javascript"></script>
{% endblock %}

{% block body %}
      <h1>About Us</h1>
      <table>
        <tr>
          <td colspan=2 id=content class=box>
The Sydney Linux User Group (SLUG) is a community of passionate freedom and
technology lovers in Sydney, Australia.

We are one of the largest and most active Linux users groups in the world,
with a adiverse membership of users, developers, sysadminas and advocates.

etc.
          </td><!-- content -->
        </tr><tr>
          <td id=youtube>
            <div id="youtube-wrapper">
            </div>
          </td><!-- youtube -->
          <td id=twitter>
            <div id="twitter-show">
              <a id="twitter-hash"href="#" >#sydlug</a>
              <a id="twitter-user" href="#">@slugupdates</a>
              <a id="twitter-both" href="#">both</a>
            </div>
            <div class=tweet>
              <ul class='tweet_list'>
                <li class='tweet_first tweet_odd'>Loading tweets...</li>
              </ul>
            </div>
          </td><!-- twitter -->
        </tr>
      </table>
{% endblock %}

{% block leftbar %}
  <div id=leftbar>
    {% if current_events %}
    <div id=today class=box>
      <h2>Events Today</h2>
      <ul>
        {% for event in current_events %}
        <li class=eventitem>
        <h3><a class=eventname href="{{ event.get_url }}">{{ event.name }}</a></h3>
          {% if appengine_admin %}
            <div class=editlink><a href="{{ event.get_url }}/edit">Edit</a></div>
          {% endif %}
          <span class=start>{{ event.start }}</span>
          <div class=event-icons>
            <div class="ical-link"><a href="{{ event.get_url }}.ics" title="Add this event to your iCalendar"><img src="/images/ical16x16.gif" alt="Add event to iCalendar"></a></div>
          </div>
          <div class=respond>
            {% if openid_user %}
            <iframe src="{{ event.get_url }}/response/show"></iframe>
            {% else %}
            <a href="{{ openid_login_url }}">Login to RSVP!</a>
            {% endif %}
          </div>

        </li>
        {% endfor %}
      </ul>
    </div><!-- today -->
    {% endif %}

    <div id=future class=box>
      <h2>Future Events</h2>
      <ul>
        {% for event in future_events %}
        <li class=eventitem>
        <h3><a class=eventname href="{{ event.get_url }}">{{ event.name }}</a></h3>
          {% if appengine_admin %}
            <div class=editlink><a href="{{ event.get_url }}/edit">Edit</a></div>
          {% endif %}
          <span class=start>{{ event.start }}</span>
          <div class=event-icons>
            <div class="ical-link"><a href="{{ event.get_url }}.ics" title="Add this event to your iCalendar"><img src="/images/ical16x16.gif" alt="Add event to iCalendar"></a></div>
          </div>
          <div class=respond>
            {% if openid_user %}
            <iframe src="{{ event.get_url }}/response/show"></iframe>
            {% else %}
            <a href="{{ openid_login_url }}">Login to RSVP!</a>
            {% endif %}
          </div>
        </li>
        {% endfor %}
      </ul>
    </div><!-- future -->
  </div><!-- leftbar -->
{% endblock %}

{% block footer %}
<div id=footer>
  <div id=attend class=box onclick="location.href='/event/next'">
    <h2> Attend </h2>
    <span class=minor>the next meeting</span>
  </div>
  <div id=sponsor class=box>
    <h2> Sponsor </h2>
    <span class=minor> An event or SLUG as a whole </span>
  </div>
  <div id=speak class=box>
    <h2> Give a talk </h2>
    <span class=minor> Educate your fellows </span>
  </div>
</div>
{% endblock %}


{% block script %}
<script>

var tweet_loading = '';
var tweet_notfound = '';
function twitter_setup() {
  var tweet_div = $(".tweet");

  var hash = '#sydlug';
  var user = 'from:slugupdates OR to:slugupdates OR @slugupdates';
  var both = hash + ' OR ' + user;
  $('#twitter-hash').click(function() { twitter(hash); return false; });
  $('#twitter-user').click(function() { twitter(user); return false; });
  $('#twitter-both').click(function() { twitter(both); return false; });

  tweet_loading = tweet_div.html();
  tweet_notfound = tweet_loading.replace(/Loading tweets.../, 'No tweets found...');

  $("#twitter-both").click();
}

function twitter(query) {
  var tweet_div = $(".tweet");
  tweet_div.remove();

  tweet_div = $("<div class=tweet></div>");
  tweet_div.tweet({
    query: query,
    avatar_size: 32,
    count: 5,
    loading_text: tweet_loading,
    template: "{avatar}{text}{time}",
    auto_join_text_default: "",
    auto_join_text_ed: "",
    auto_join_text_ing: "",
    auto_join_text_reply: "",
    auto_join_text_url: ""
  }).bind("empty", function() {
    $(this).empty();
    $(this).html(tweet_notfound);
  });

  tweet_div.appendTo($("#twitter"));
}

$(document).ready(function(){

  twitter_setup();

  // Setup the YouTube widget
  var firstScriptTag = document.getElementsByTagName('script')[0];

  // Get the SLUG playlist
  var tag = document.createElement('script');
  tag.src = "http://gdata.youtube.com/feeds/api/playlists/F6073A99A735F849?v=2&alt=jsonc&callback=youtube_playlist_callback";
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // Load the jquery plugin...
  var tag = document.createElement('script');
  tag.src = "/third_party/jquery.youtubecloud/jquery.youtubecloud.js";
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // Load the You Tube iFrame API...
  var tag = document.createElement('script');
  tag.src = "http://www.youtube.com/player_api";
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
});

var youtube_api_ready = false;
function onYouTubePlayerAPIReady() {
  youtube_api_ready = true;
  youtube_setup();
}

var youtube_playlist_ready = false;
function youtube_playlist_callback(data) {
  youtube_playlist_ready = true;
  var container = $('#youtube-wrapper');
  console.log('playlist_callback', data.data.items);
  $.each(data.data.items, function(index, item) {
    container.append($('<div>').attr('data', item.video.id));
  });
  youtube_setup();
}

function youtube_setup() {
  if (youtube_playlist_ready && youtube_api_ready) {
    $("#youtube-wrapper").youtubecloud();
  }
}
</script>
{%endblock %}
